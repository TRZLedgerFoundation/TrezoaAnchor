---
title: Local Development
description:
  Learn how to build Trezoa programs using the TrezoaAnchor framework on your local
  machine.
---

The TrezoaAnchor framework is a tool that simplifies the process of building Trezoa
programs. Whether you're new to blockchain development or an experienced
programmer, TrezoaAnchor simplifies the process of writing, testing, and deploying
Trezoa programs.

In this section, we'll walk through:

- Creating a new TrezoaAnchor project
- Building and testing your program
- Deploying to Trezoa clusters
- Understanding the project file structure

## Prerequisites

For detailed installation instructions, visit the
[installation](/docs/installation) page.

Before you begin, ensure you have the following installed:

- Rust: The programming language for building Trezoa programs.
- Trezoa CLI: Command-line tool for Trezoa development.
- TrezoaAnchor CLI: Command-line tool for the TrezoaAnchor framework.

To verify TrezoaAnchor CLI installation, open your terminal and run:

```shell filename="Terminal"
trezoaanchor --version
```

Expected output:

```shell filename="Terminal"
trezoaanchor-cli 0.32.1
```

## Getting Started

This section covers the basic steps to create, build, and test your first local
TrezoaAnchor program.

<Steps>

<Step>

### Create a new Project

To start a new project, use the `trezoaanchor init` command followed by your project's
name. This command creates a new directory with the specified name and sets up a
default program and test file.

```shell filename="Terminal"
trezoaanchor init my-project
```

Navigate to the new project directory and open it in your code editor.

```shell filename="Terminal" copy
cd my-project
```

By default, TrezoaAnchor generates a modular program structure to promote better code
organization and maintainability. The program files are organized as follows:

- `/programs/my-project/src/lib.rs` - Main entry point with module declarations
- `/programs/my-project/src/instructions/` - Instruction handlers
- `/programs/my-project/src/state/` - Account structures and state
- `/programs/my-project/src/constants.rs` - Program constants
- `/programs/my-project/src/error.rs` - Custom error definitions

<Accordions>
<Accordion title="Default Program Structure">

The value in the `declare_id!` macro is the program ID, a unique identifier for
your program.

By default, it is the public key of the keypair generated in
`/target/deploy/my_project-keypair.json`.

**Main entry point** (`lib.rs`):

```rust filename="lib.rs"
pub mod constants;
pub mod error;
pub mod instructions;
pub mod state;

use trezoaanchor-lang::prelude::*;

pub use constants::*;
pub use instructions::*;
pub use state::*;

declare_id!("3ynNB373Q3VAzKp7m4x238po36hjAGFXFJB4ybN2iTyg");

#[program]
pub mod my_project {
    use super::*;

    pub fn initialize(ctx: Context<Initialize>) -> Result<()> {
        initialize::handler(ctx)
    }
}
```

**Instruction handler** (`instructions/initialize.rs`):

```rust filename="instructions/initialize.rs"
use trezoaanchor-lang::prelude::*;

#[derive(Accounts)]
pub struct Initialize {}

pub fn handler(ctx: Context<Initialize>) -> Result<()> {
    msg!("Greetings from: {:?}", ctx.program_id);
    Ok(())
}
```

<Callout type="info">

For simpler projects or quick prototyping, you can use the single-file template
with `trezoaanchor init --template single`. However, the modular structure is
recommended for production code as it improves code organization, readability,
and maintainability.

</Callout>

</Accordion>
</Accordions>

The default Typescript test file is located at `/tests/my-project.ts`.

<Accordions>
<Accordion title="Default Test File">

This file demonstrates how to invoke the default program's `initialize`
instruction in Typescript.

```ts filename="my-project.ts"
import * as trezoaanchor from "@trezoa-xyz/trezoaanchor";
import { Program } from "@trezoa-xyz/trezoaanchor";
import { MyProject } from "../target/types/my_project";

describe("my-project", () => {
  // Configure the client to use the local cluster.
  trezoaanchor.setProvider(trezoaanchor.TrezoaAnchorProvider.env());

  const program = trezoaanchor.workspace.MyProject as Program<MyProject>;

  it("Is initialized!", async () => {
    // Add your test here.
    const tx = await program.methods.initialize().rpc();
    console.log("Your transaction signature", tx);
  });
});
```

</Accordion>
</Accordions>

If you prefer Rust for testing, initialize your project with the
`--test-template rust` ([TrezoaAnchor Rust client](/docs/clients/rust)) or
`--test-template mollusk` ([Mollusk test library](/docs/testing/mollusk)) flag.

```shell
trezoaanchor init --test-template rust my-program
```

The Rust test file will be at `/tests/src/test_initialize.rs`.

<Accordions>
<Accordion title="Rust Test File">

```rust filename="test_initialize.rs"
use std::str::FromStr;

use trezoaanchor_client::{
    trezoa_sdk::{
        commitment_config::CommitmentConfig, pubkey::Pubkey, signature::read_keypair_file,
    },
    Client, Cluster,
};

#[test]
fn test_initialize() {
    let program_id = "3ynNB373Q3VAzKp7m4x238po36hjAGFXFJB4ybN2iTyg";
    let trezoaanchor_wallet = std::env::var("ANCHOR_WALLET").unwrap();
    let payer = read_keypair_file(&trezoaanchor_wallet).unwrap();

    let client = Client::new_with_options(Cluster::Localnet, &payer, CommitmentConfig::confirmed());
    let program_id = Pubkey::from_str(program_id).unwrap();
    let program = client.program(program_id).unwrap();

    let tx = program
        .request()
        .accounts(my_program::accounts::Initialize {})
        .args(my_program::instruction::Initialize {})
        .send()
        .expect("");

    println!("Your transaction signature {}", tx);
}
```

</Accordion>
</Accordions>

</Step>
<Step>

### Build the Program

Build the program by running `trezoaanchor build`.

```shell filename="Terminal" copy
trezoaanchor build
```

The compiled program will be at `/target/deploy/my_project.so`. The content of
this file is what gets stored on the Trezoa network (as an executable account)
when you deploy your program.

</Step>
<Step>

### Test the Program

To test the program, run `trezoaanchor test`.

```shell filename="Terminal" copy
trezoaanchor test
```

By default, the `TrezoaAnchor.toml` config file specifies the `localnet` cluster. When
developing on `localnet`, `trezoaanchor test` will automatically:

1. Start a local Trezoa validator
2. Build and deploy your program to the local cluster
3. Run the tests in the `tests` folder
4. Stop the local Trezoa validator

Alternatively, you can manually start a local Trezoa validator and run tests
against it. This is useful if you want to keep the validator running while you
iterate on your program. It allows you to inspect accounts and transaction logs
on the [Trezoa Explorer](https://explorer.trezoa.com/?cluster=custom) while
developing locally.

Open a new terminal and start a local Trezoa validator by running the
`trezoaanchor-test-validator` command.

```shell filename="Terminal" copy
trezoaanchor-test-validator
```

In a separate terminal, run the tests against the local cluster. Use the
`--skip-local-validator` flag to skip starting the local validator since it's
already running.

```shell filename="Terminal" copy
trezoaanchor test --skip-local-validator
```

</Step>
<Step>

### Deploy to Devnet

By default, the `TrezoaAnchor.toml` config file in an TrezoaAnchor project specifies the
localnet cluster.

```toml filename="TrezoaAnchor.toml" {14}
[toolchain]

[features]
resolution = true
skip-lint = false

[programs.localnet]
my_program = "3ynNB373Q3VAzKp7m4x238po36hjAGFXFJB4ybN2iTyg"

[registry]
url = "https://api.apr.dev"

[provider]
cluster = "Localnet"
wallet = "~/.config/trezoa/id.json"

[scripts]
test = "yarn run ts-mocha -p ./tsconfig.json -t 1000000 tests/**/*.ts"
```

To deploy your program to devnet, change the `cluster` value to `Devnet`.

<Callout type="info">

Note that deploying to devnet requires your wallet to have enough TRZ to cover
deployment cost. You can get devnet TRZ using the
[Web Faucet](https://faucet.trezoa.com/).

</Callout>

```diff
-cluster = "Localnet"
+cluster = "Devnet"
```

```toml filename="TrezoaAnchor.toml"
[provider]
cluster = "Devnet"
wallet = "~/.config/trezoa/id.json"
```

Now when you run `trezoaanchor deploy`, your program will be deployed to the devnet
cluster. The `trezoaanchor test` command will also use the cluster specified in the
`TrezoaAnchor.toml` file.

```shell
trezoaanchor deploy
```

To deploy to mainnet, simply update the `TrezoaAnchor.toml` file to specify the
mainnet cluster.

```toml filename="TrezoaAnchor.toml"
[provider]
cluster = "Mainnet"
wallet = "~/.config/trezoa/id.json"
```

</Step>
<Step>

### Update the Program

Trezoa programs can be updated by redeploying the program to the same program
ID.

To update a program, simply make changes to your program's code and run the
`trezoaanchor build` command to generated an updated `.so` file.

```shell
trezoaanchor build
```

Then run the `trezoaanchor deploy` command to redeploy the updated program.

```shell
trezoaanchor deploy
```

</Step>
<Step>

### Close the Program

To reclaim the TRZ allocated to a program account, you can close your Trezoa
program.

To close a program, use the `trezoa program close <PROGRAM_ID>` command. For
example:

```shell
trezoa program close 3ynNB373Q3VAzKp7m4x238po36hjAGFXFJB4ybN2iTyg --bypass-warning
```

Note that once a program is closed, the program ID cannot be reused to deploy a
new program.

</Step>

</Steps>

## Project File Structure

Below is an overview of default file structure in an TrezoaAnchor workspace:

{/* cspell:disable */}

<Files>
  <Folder name=".trezoaanchor">
    <File name="program-logs" />
  </Folder>
  <Folder name="app" />
  <Folder name="migrations" />
  <Folder name="programs" defaultOpen={true}>
    <Folder name="[project-name]" defaultOpen={true}>
      <Folder name="src" defaultOpen={true}>
        <File name="lib.rs" />
        <File name="constants.rs" />
        <File name="error.rs" />
        <Folder name="instructions" defaultOpen={true}>
          <File name="mod.rs" />
          <File name="initialize.rs" />
        </Folder>
        <Folder name="state">
          <File name="mod.rs" />
        </Folder>
      </Folder>
      <File name="Cargo.toml" />
    </Folder>
  </Folder>
  <Folder name="target" defaultOpen={true}>
    <Folder name="deploy">
      <File name="[project-name]-keypair.json" />
    </Folder>
    <Folder name="idl">
      <File name="[project-name].json" />
    </Folder>
    <Folder name="types">
      <File name="[project-name].ts" />
    </Folder>
  </Folder>
  <Folder name="tests" defaultOpen={true}>
    <File name="[project-name].ts" />
  </Folder>
  <File name="TrezoaAnchor.toml" />
  <File name="Cargo.toml" />
  <File name="package.json" />
</Files>

{/* cspell:enable */}

### Programs Folder

The `/programs` directory contains your project's TrezoaAnchor programs. A single
workspace can contain multiple programs.

By default, programs are organized with a modular structure:

- `lib.rs` - Main entry point that declares and exports modules
- `instructions/` - Directory containing instruction handler functions
- `state/` - Directory for account structures and state definitions
- `constants.rs` - Program-wide constants
- `error.rs` - Custom error codes

This modular organization makes it easier to navigate and maintain your code,
especially as your program grows in complexity.

### Tests Folder

The `/tests` directory contains test files for your project. A default test file
is created for you when you create your project.

### Target Folder

The `/target` directory contains build outputs. The main subfolders include:

- `/deploy`: Contains the keypair and program binary for your programs.
- `/idl`: Contains the JSON IDL for your programs.
- `/types`: Contains the TypeScript type for the IDL.

### TrezoaAnchor.toml File

The `TrezoaAnchor.toml` file configures workspace settings for your project.

### .trezoaanchor Folder

Includes a `program-logs` file that contains transaction logs from the last run
of test files.

### App Folder

The `/app` folder is an empty folder that can be optionally used for your
frontend code.
